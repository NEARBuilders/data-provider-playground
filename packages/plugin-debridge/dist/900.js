"use strict";exports.ids=["900"],exports.modules={5663:function(e,t,r){r.r(t),r.d(t,{default:()=>en});var n=r(2281),a=r(1250),o=r(8974),i=r(9963),s=o.z.object({chainId:o.z.string(),assetId:o.z.string(),symbol:o.z.string(),decimals:o.z.number().int().min(0)}),u=o.z.object({source:s,destination:s,amountIn:o.z.string(),amountOut:o.z.string(),effectiveRate:o.z.number().describe("amountOut/amountIn normalized for decimals"),totalFeesUsd:o.z.number().nullable(),quotedAt:o.z.iso.datetime()}),c=o.z.object({maxAmountIn:o.z.string(),slippageBps:o.z.number()}),l=o.z.object({route:o.z.object({source:s,destination:s}),thresholds:o.z.array(c),measuredAt:o.z.iso.datetime()}),h=o.z.object({window:o.z.enum(["24h","7d","30d"]),volumeUsd:o.z.number(),measuredAt:o.z.iso.datetime()}),f=o.z.object({assets:o.z.array(s),measuredAt:o.z.iso.datetime()}),d=o.z.object({volumes:o.z.array(h),rates:o.z.array(u),liquidity:o.z.array(l),listedAssets:f}),m=i.oc.router({getSnapshot:i.oc.route({method:"GET",path:"/snapshot"}).input(o.z.object({routes:o.z.array(o.z.object({source:s,destination:s})).min(1),notionals:o.z.array(o.z.string()).min(1),includeWindows:o.z.array(o.z.enum(["24h","7d","30d"])).default(["24h"]).optional()})).output(d).errors(n.CommonPluginErrors),ping:i.oc.route({method:"GET",path:"/ping"}).output(o.z.object({status:o.z.literal("ok"),timestamp:o.z.string().datetime()})).errors(n.CommonPluginErrors)}),p=r(8946);function y(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}var b=function(){var e;function t(){if(!(this instanceof t))throw TypeError("Cannot call a class as a function")}return e=[{key:"calculateEffectiveRate",value:function(e,t,r,n){if(!e||!t||"number"!=typeof r||"number"!=typeof n||r<0||n<0)throw Error("Invalid input parameters for rate calculation");try{var a=new p.A(e).div(new p.A(10).pow(r)),o=new p.A(t).div(new p.A(10).pow(n));if(a.isZero())throw Error("From amount cannot be zero");return o.div(a).toNumber()}catch(e){throw Error("Decimal calculation failed: ".concat(y(e,Error)?e.message:String(e)))}}},{key:"sumFees",value:function(e){if(!Array.isArray(e))throw Error("Fees must be an array");try{return e.reduce(function(e,t){if(!(null==t?void 0:t.amountUSD))return e;var r="string"==typeof t.amountUSD?t.amountUSD:t.amountUSD.toString();return e.plus(new p.A(r))},new p.A(0)).toNumber()}catch(e){throw Error("Fee calculation failed: ".concat(y(e,Error)?e.message:String(e)))}}},{key:"calculateSlippageBps",value:function(e,t){var r=new p.A(e),n=new p.A(t);return r.isZero()?0:r.minus(n).div(r).times(1e4).abs().toNumber()}},{key:"normalizeAmount",value:function(e,t){return new p.A(e).div(new p.A(10).pow(t))}},{key:"denormalizeAmount",value:function(e,t){var r="number"==typeof e?e.toString():e;return new p.A(r).times(new p.A(10).pow(t)).toFixed(0,p.A.ROUND_DOWN)}}],function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t,e),t}(),v=r(1383),g=r.n(v);function w(e,t,r,n,a,o,i){try{var s=e[o](i),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(n,a)}function S(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function i(e){w(o,n,a,i,s,"next",e)}function s(e){w(o,n,a,i,s,"throw",e)}i(void 0)})}}function A(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){A(e,t,r[t])})}return e}function C(e,t){var r,n,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){var c=[s,u];if(r)throw TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(o=0)),o;)try{if(r=1,n&&(a=2&c[0]?n.return:c[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,c[1])).done)return a;switch(n=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,n=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===c[0]||2===c[0])){o=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){o.label=c[1];break}if(6===c[0]&&o.label<a[1]){o.label=a[1],a=c;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(c);break}a[2]&&o.ops.pop(),o.trys.pop();continue}c=t.call(e,o)}catch(e){c=[6,e],n=0}finally{r=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}var O=function(){var e;function t(){if(!(this instanceof t))throw TypeError("Cannot call a class as a function")}return e=[{key:"configure",value:function(e){var t,r,n={maxConcurrent:null!=(t=e.maxConcurrent)?t:5,minTime:null!=(r=e.minTime)?r:200};this.limiter=new(g())(n),this.lastConfig=n}},{key:"getLimiterConfig",value:function(){return this.lastConfig}},{key:"fetchWithRetry",value:function(e){return S(function(e){var t,r,n,a,o=arguments;return C(this,function(i){if(t=this,r=o.length>1&&void 0!==o[1]?o[1]:{},n=o.length>2&&void 0!==o[2]?o[2]:3,a=o.length>3&&void 0!==o[3]?o[3]:1e3,!e||"string"!=typeof e)throw Error("Valid URL is required");if(n<0||a<0)throw Error("maxRetries and baseDelay must be non-negative");try{new URL(e)}catch(t){throw Error("Invalid URL format: ".concat(e))}return[2,this.limiter.schedule(function(){return S(function(){var t,o,i,s,u;return C(this,function(c){switch(c.label){case 0:o=function(o){var s,u,c,l,h,f,d,m,p;return C(this,function(y){var b,v,g,w;switch(y.label){case 0:return y.trys.push([0,6,,9]),s=new AbortController,u=setTimeout(function(){return s.abort()},3e4),[4,fetch(e,(b=k({},r),v=v={signal:s.signal,headers:k({"Content-Type":"application/json"},r.headers)},Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(v)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(v)).forEach(function(e){Object.defineProperty(b,e,Object.getOwnPropertyDescriptor(v,e))}),b))];case 1:if(c=y.sent(),clearTimeout(u),c.ok)return[3,4];if(429!==c.status||(h=(l=c.headers.get("retry-after"))?1e3*parseInt(l):t.calculateBackoffDelay(o,a),!(o<n)))return[3,3];return[4,t.sleep(h)];case 2:return y.sent(),[2,"continue"];case 3:throw Error("HTTP ".concat(c.status,": ").concat(c.statusText));case 4:try{if(!(null==(f=c.headers.get("content-type"))?void 0:f.includes("application/json")))throw Error("Response is not JSON")}catch(e){throw Error("Invalid response headers")}return d={},[4,c.json()];case 5:return[2,(d.v=y.sent(),d)];case 6:if(g=m=y.sent(),i=(null!=(w=Error)&&"undefined"!=typeof Symbol&&w[Symbol.hasInstance]?!!w[Symbol.hasInstance](g):g instanceof w)?m:Error(String(m)),!(o<n))return[3,8];return p=t.calculateBackoffDelay(o,a),[4,t.sleep(p)];case 7:y.sent(),y.label=8;case 8:return[3,9];case 9:return[2]}})},s=0,c.label=1;case 1:if(!(s<=n))return[3,4];return t=this,[5,function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(o(s))];case 2:var l;if("object"==((l=u=c.sent())&&"undefined"!=typeof Symbol&&l.constructor===Symbol?"symbol":typeof l))return[2,u.v];c.label=3;case 3:return s++,[3,1];case 4:throw Error("Request failed after ".concat(n+1," attempts: ").concat(i.message))}})}).call(t)})]})}).apply(this,arguments)}},{key:"calculateBackoffDelay",value:function(e,t){if("number"!=typeof e||"number"!=typeof t||e<0||t<0)return 1e3;var r=t*Math.pow(2,Math.min(e,10)),n=.1*Math.random()*r;return Math.min(r+n,3e4)}},{key:"sleep",value:function(e){return new Promise(function(t){return setTimeout(t,e)})}}],function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t,e),t}();function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function E(e,t,r,n,a,o,i){try{var s=e[o](i),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(n,a)}function x(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function i(e){E(o,n,a,i,s,"next",e)}function s(e){E(o,n,a,i,s,"throw",e)}i(void 0)})}}function j(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function z(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function D(e,t,r){return t&&z(e.prototype,t),r&&z(e,r),e}function P(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function T(e,t){var r,n,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){var c=[s,u];if(r)throw TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(o=0)),o;)try{if(r=1,n&&(a=2&c[0]?n.return:c[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,c[1])).done)return a;switch(n=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,n=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===c[0]||2===c[0])){o=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){o.label=c[1];break}if(6===c[0]&&o.label<a[1]){o.label=a[1],a=c;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(c);break}a[2]&&o.ops.pop(),o.trys.pop();continue}c=t.call(e,o)}catch(e){c=[6,e],n=0}finally{r=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}A(O,"limiter",new(g())({maxConcurrent:5,minTime:200})),A(O,"lastConfig",{maxConcurrent:5,minTime:200});var U=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;j(this,e),P(this,"cache",new Map),P(this,"ttlMs",void 0),P(this,"maxSize",void 0),this.ttlMs=t,this.maxSize=r}return D(e,[{key:"get",value:function(e){var t=this.cache.get(e);if(t)return Date.now()>t.expiresAt?void this.cache.delete(e):t.value}},{key:"set",value:function(e,t){if(this.cache.size>=this.maxSize){var r=this.cache.keys().next().value;void 0!==r&&this.cache.delete(r)}this.cache.set(e,{value:t,expiresAt:Date.now()+this.ttlMs})}},{key:"has",value:function(e){return void 0!==this.get(e)}},{key:"clear",value:function(){this.cache.clear()}},{key:"stats",value:function(){var e=Date.now(),t=!0,r=!1,n=void 0;try{for(var a,o=this.cache.entries()[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var i,s=(i=a.value,function(e){if(Array.isArray(e))return e}(i)||function(e,t){var r,n,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var o=[],i=!0,s=!1;try{for(a=a.call(e);!(i=(r=a.next()).done)&&(o.push(r.value),2!==o.length);i=!0);}catch(e){s=!0,n=e}finally{try{i||null==a.return||a.return()}finally{if(s)throw n}}return o}}(i,2)||function(e,t){if(e){if("string"==typeof e)return I(e,2);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return I(e,2)}}(i,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=s[0],c=s[1];e>c.expiresAt&&this.cache.delete(u)}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}return{size:this.cache.size,maxSize:this.maxSize,ttlMs:this.ttlMs}}}]),e}(),B=function(){function e(){j(this,e),P(this,"pending",new Map)}return D(e,[{key:"deduplicate",value:function(e,t){return x(function(){var r,n,a;return T(this,function(o){return(r=this,n=this.pending.get(e))?[2,n]:(a=t().finally(function(){r.pending.delete(e)}),this.pending.set(e,a),[2,a])})}).call(this)}},{key:"clear",value:function(){this.pending.clear()}},{key:"pendingCount",value:function(){return this.pending.size}}]),e}(),F=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;j(this,e),P(this,"failureThreshold",void 0),P(this,"cooldownMs",void 0),P(this,"successThreshold",void 0),P(this,"state",void 0),P(this,"failureCount",void 0),P(this,"successCount",void 0),P(this,"nextAttemptTime",void 0),this.failureThreshold=t,this.cooldownMs=r,this.successThreshold=n,this.state="CLOSED",this.failureCount=0,this.successCount=0,this.nextAttemptTime=0}return D(e,[{key:"execute",value:function(e){return x(function(){var t,r,n;return T(this,function(a){switch(a.label){case 0:if(t=Date.now(),"OPEN"===this.state){if(t<this.nextAttemptTime)throw Error("Circuit breaker is OPEN - service is unavailable");this.state="HALF_OPEN",this.successCount=0}a.label=1;case 1:return a.trys.push([1,3,,4]),[4,e()];case 2:return r=a.sent(),this.onSuccess(),[2,r];case 3:throw n=a.sent(),this.onFailure(),n;case 4:return[2]}})}).call(this)}},{key:"onSuccess",value:function(){this.failureCount=0,"HALF_OPEN"===this.state&&(this.successCount++,this.successCount>=this.successThreshold&&(this.state="CLOSED",this.successCount=0))}},{key:"onFailure",value:function(){this.failureCount++,this.successCount=0,("HALF_OPEN"===this.state||this.failureCount>=this.failureThreshold)&&(this.state="OPEN",this.nextAttemptTime=Date.now()+this.cooldownMs)}},{key:"getState",value:function(){return{state:this.state,failureCount:this.failureCount,successCount:this.successCount}}},{key:"reset",value:function(){this.state="CLOSED",this.failureCount=0,this.successCount=0,this.nextAttemptTime=0}}]),e}();function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function L(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function M(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function N(e,t,r){return t&&M(e.prototype,t),r&&M(e,r),e}function q(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var K=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";L(this,e),q(this,"context",void 0),q(this,"minLevel",void 0),this.context=t,this.minLevel=r}return N(e,[{key:"shouldLog",value:function(e){var t=["debug","info","warn","error"];return t.indexOf(e)>=t.indexOf(this.minLevel)}},{key:"formatLog",value:function(e){var t=e.metadata?" ".concat(JSON.stringify(e.metadata)):"";return"[".concat(e.timestamp,"] [").concat(e.level.toUpperCase(),"] [").concat(e.context,"] ").concat(e.message).concat(t)}},{key:"log",value:function(e,t,r){if(this.shouldLog(e)){var n={timestamp:new Date().toISOString(),level:e,message:t,context:this.context,metadata:r},a=this.formatLog(n);switch(e){case"debug":case"info":console.log(a);break;case"warn":console.warn(a);break;case"error":console.error(a)}}}},{key:"debug",value:function(e,t){this.log("debug",e,t)}},{key:"info",value:function(e,t){this.log("info",e,t)}},{key:"warn",value:function(e,t){this.log("warn",e,t)}},{key:"error",value:function(e,t){this.log("error",e,t)}},{key:"child",value:function(t){return new e("".concat(this.context,":").concat(t),this.minLevel)}},{key:"setLevel",value:function(e){this.minLevel=e}}]),e}(),V=function(){function e(){L(this,e),q(this,"startTime",void 0),q(this,"marks",new Map),this.startTime=Date.now()}return N(e,[{key:"mark",value:function(e){this.marks.set(e,Date.now())}},{key:"elapsed",value:function(){return Date.now()-this.startTime}},{key:"measure",value:function(e,t){var r=this.marks.get(e),n=this.marks.get(t);if(r&&n)return n-r}},{key:"getMetadata",value:function(){var e={totalMs:this.elapsed()},t=!0,r=!1,n=void 0;try{for(var a,o=this.marks.entries()[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var i,s=(i=a.value,function(e){if(Array.isArray(e))return e}(i)||function(e,t){var r,n,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var o=[],i=!0,s=!1;try{for(a=a.call(e);!(i=(r=a.next()).done)&&(o.push(r.value),2!==o.length);i=!0);}catch(e){s=!0,n=e}finally{try{i||null==a.return||a.return()}finally{if(s)throw n}}return o}}(i,2)||function(e,t){if(e){if("string"==typeof e)return R(e,2);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return R(e,2)}}(i,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=s[0],c=s[1];e["".concat(u,"Ms")]=c-this.startTime}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}return e}}]),e}();function W(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function G(e,t,r,n,a,o,i){try{var s=e[o](i),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(n,a)}function _(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function i(e){G(o,n,a,i,s,"next",e)}function s(e){G(o,n,a,i,s,"throw",e)}i(void 0)})}}function H(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Q(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function J(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){H(e,t,r[t])})}return e}function $(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r,n,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var o=[],i=!0,s=!1;try{for(a=a.call(e);!(i=(r=a.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){s=!0,n=e}finally{try{i||null==a.return||a.return()}finally{if(s)throw n}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return W(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return W(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Z(e,t){var r,n,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){var c=[s,u];if(r)throw TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(o=0)),o;)try{if(r=1,n&&(a=2&c[0]?n.return:c[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,c[1])).done)return a;switch(n=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,n=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===c[0]||2===c[0])){o=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){o.label=c[1];break}if(6===c[0]&&o.label<a[1]){o.label=a[1],a=c;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(c);break}a[2]&&o.ops.pop(),o.trys.pop();continue}c=t.call(e,o)}catch(e){c=[6,e],n=0}finally{r=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}function X(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var Y=function(){var e;function t(e,r,n){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");H(this,"baseUrl",void 0),H(this,"apiKey",void 0),H(this,"timeout",void 0),H(this,"dlnApiBase",void 0),H(this,"statsApiBase",void 0),H(this,"logger",void 0),H(this,"quoteCache",void 0),H(this,"assetsCache",void 0),H(this,"volumeCache",void 0),H(this,"deduplicator",void 0),H(this,"dlnCircuit",void 0),H(this,"statsCircuit",void 0),this.baseUrl=e,this.apiKey=r,this.timeout=n,this.quoteCache=new U(3e5),this.assetsCache=new U(36e5),this.volumeCache=new U(3e5),this.deduplicator=new B,this.dlnCircuit=new F(5,6e4),this.statsCircuit=new F(5,6e4),this.dlnApiBase=e.includes("dln.debridge.finance")?e:"https://dln.debridge.finance/v1.0",this.statsApiBase="https://stats-api.dln.trade/api",this.logger=new K("deBridge:Service",("undefined"!=typeof process?process.env.LOG_LEVEL:"info")||"info"),this.logger.info("DataProviderService initialized",{dlnApiBase:this.dlnApiBase,statsApiBase:this.statsApiBase,hasApiKey:!!this.apiKey})}return e=[{key:"getSnapshot",value:function(e){var t,r,n=this;return(null==e||null==(t=e.routes)?void 0:t.length)&&(null==e||null==(r=e.notionals)?void 0:r.length)?a.Effect.tryPromise({try:function(){return _(function(){var t,r,n,a,o,i,s;return Z(this,function(u){switch(u.label){case 0:t=new V,this.logger.info("Snapshot fetch started",{routeCount:e.routes.length,notionalCount:e.notionals.length,windows:e.includeWindows}),u.label=1;case 1:return u.trys.push([1,3,,4]),t.mark("fetchStart"),[4,Promise.all([this.getVolumes(e.includeWindows||["24h"]),this.getRates(e.routes,e.notionals),this.getLiquidityDepth(e.routes),this.getListedAssets()])];case 2:var c,l;return n=(r=$.apply(void 0,[u.sent(),4]))[0],a=r[1],o=r[2],i=r[3],t.mark("fetchEnd"),this.logger.info("Snapshot fetch completed",(c=J({},t.getMetadata()),l=l={volumeCount:n.length,rateCount:a.length,liquidityCount:o.length,assetCount:i.assets.length},Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(l)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(l)).forEach(function(e){Object.defineProperty(c,e,Object.getOwnPropertyDescriptor(l,e))}),c)),[2,{volumes:n,rates:a,liquidity:o,listedAssets:i}];case 3:throw s=u.sent(),this.logger.error("Snapshot fetch failed",{error:Q(s,Error)?s.message:String(s),elapsed:t.elapsed()}),Error("Snapshot fetch failed: ".concat(Q(s,Error)?s.message:String(s)));case 4:return[2]}})}).call(n)},catch:function(e){return Error("Failed to fetch snapshot: ".concat(Q(e,Error)?e.message:String(e)))}}):a.Effect.fail(Error("Routes and notionals are required"))}},{key:"getVolumes",value:function(e){return _(function(){var t,r,n,a,o,i,s,u,c,l,h,f,d,m;return Z(this,function(p){switch(p.label){case 0:if(t=this,r=e.sort().join(","),n=this.volumeCache.get(r))return this.logger.debug("Volume cache hit",{windows:e,cacheKey:r}),[2,n];this.logger.info("Fetching volumes",{windows:e}),p.label=1;case 1:p.trys.push([1,10,,11]),a=[],o=Date.now(),i=!0,s=!1,u=void 0,p.label=2;case 2:p.trys.push([2,7,8,9]),l=function(){var e,r,n,i,s,u,l,h,d,m,p,y,b;return Z(this,function(v){switch(v.label){case 0:e=f.value,v.label=1;case 1:v.trys.push([1,8,,9]),r=o-({"24h":864e5,"7d":6048e5,"30d":2592e6})[e],n="".concat(c.statsApiBase,"/Orders/filteredList"),v.label=2;case 2:v.trys.push([2,6,,7]),s=function(){var r,a;return Z(this,function(o){switch(o.label){case 0:return r={orderStates:["Fulfilled","SentUnlock","ClaimedUnlock"],externalCallStates:["NoExtCall"],skip:l*d,take:d},[4,i.statsCircuit.execute(function(){return t.deduplicator.deduplicate("volume-".concat(e,"-").concat(l),function(){return O.fetchWithRetry(n,{method:"POST",headers:J({"Content-Type":"application/json"},t.apiKey?{Authorization:"Bearer ".concat(t.apiKey)}:{}),body:JSON.stringify(r)})})})];case 1:if(!(a=o.sent()).orders||0===a.orders.length||(u=u.concat(a.orders),a.orders.length<d))return[2,"break"];return l++,[2]}})},u=[],l=0,h=5,d=1e3,v.label=3;case 3:if(!(l<h))return[3,5];return i=c,[5,X(s())];case 4:if("break"===v.sent())return[3,5];return[3,3];case 5:return c.logger.debug("Volume orders fetched",{window:e,totalOrders:u.length,pages:l+1}),m=u.filter(function(e){var t=new Date(e.createdAt).getTime();return t>=r&&t<=o}).reduce(function(e,t){return e+parseFloat(t.giveAmount||"0")/1e6},0),a.push({window:e,volumeUsd:m,measuredAt:new Date().toISOString()}),c.logger.info("Volume calculated",{window:e,volumeUsd:m,orderCount:u.length}),[3,7];case 6:return p=v.sent(),c.logger.warn("Volume API unavailable, using fallback",{window:e,error:Q(p,Error)?p.message:String(p)}),y={"24h":3e6,"7d":21e6,"30d":9e7},a.push({window:e,volumeUsd:y[e],measuredAt:new Date().toISOString()}),[3,7];case 7:return[3,9];case 8:return b=v.sent(),c.logger.error("Volume fetch error",{window:e,error:Q(b,Error)?b.message:String(b)}),a.push({window:e,volumeUsd:0,measuredAt:new Date().toISOString()}),[3,9];case 9:return[2]}})},h=e[Symbol.iterator](),p.label=3;case 3:if(i=(f=h.next()).done)return[3,6];return c=this,[5,X(l())];case 4:p.sent(),p.label=5;case 5:return i=!0,[3,3];case 6:return[3,9];case 7:return d=p.sent(),s=!0,u=d,[3,9];case 8:try{i||null==h.return||h.return()}finally{if(s)throw u}return[7];case 9:return this.volumeCache.set(r,a),[2,a];case 10:return m=p.sent(),this.logger.error("Volume fetch failed completely",{error:Q(m,Error)?m.message:String(m)}),[2,e.map(function(e){return{window:e,volumeUsd:0,measuredAt:new Date().toISOString()}})];case 11:return[2]}})}).call(this)}},{key:"getRates",value:function(e,t){return _(function(){var r,n,a,o,i,s,u,c,l,h,f,d,m,p,y,v;return Z(this,function(g){switch(g.label){case 0:if(r=this,!(null==e?void 0:e.length)||!(null==t?void 0:t.length))throw Error("Routes and notionals are required for rate fetching");this.logger.info("Fetching rates",{routeCount:e.length,notionalCount:t.length}),n=[],a=!0,o=!1,i=void 0,g.label=1;case 1:g.trys.push([1,12,13,14]),s=e[Symbol.iterator](),g.label=2;case 2:if(a=(u=s.next()).done)return[3,11];if(!(null==(c=u.value)?void 0:c.source)||!(null==c?void 0:c.destination))return this.logger.warn("Invalid route structure, skipping",{route:c}),[3,10];l=!0,h=!1,f=void 0,g.label=3;case 3:g.trys.push([3,8,9,10]),m=function(){var e,t,a,o,i,s,u,l,h,f;return Z(this,function(m){switch(m.label){case 0:if(!(e=y.value)||isNaN(Number(e)))return d.logger.warn("Invalid notional, skipping",{notional:e}),[2,"continue"];m.label=1;case 1:if(m.trys.push([1,5,,6]),t="".concat(c.source.chainId,"-").concat(c.source.assetId,"-").concat(c.destination.chainId,"-").concat(c.destination.assetId,"-").concat(e),a=d.quoteCache.get(t),o=void 0,!a)return[3,2];return d.logger.debug("Quote cache hit",{cacheKey:t}),o=a,[3,4];case 2:return(i=new URL("".concat(d.dlnApiBase,"/dln/order/create-tx"))).searchParams.set("srcChainId",c.source.chainId),i.searchParams.set("srcChainTokenIn",c.source.assetId),i.searchParams.set("srcChainTokenInAmount",e),i.searchParams.set("dstChainId",c.destination.chainId),i.searchParams.set("dstChainTokenOut",c.destination.assetId),i.searchParams.set("dstChainTokenOutAmount","auto"),i.searchParams.set("prependOperatingExpenses","true"),[4,d.dlnCircuit.execute(function(){return r.deduplicator.deduplicate(t,function(){return O.fetchWithRetry(i.toString(),{headers:r.apiKey?{Authorization:"Bearer ".concat(r.apiKey)}:{}})})})];case 3:o=m.sent(),d.quoteCache.set(t,o),d.logger.debug("Quote fetched and cached",{cacheKey:t}),m.label=4;case 4:if(!(null==o?void 0:o.estimation))throw Error("Invalid quote response structure");return s=o.estimation.srcChainTokenIn.amount,u=o.estimation.dstChainTokenOut.amount,l=0,o.protocolFeeApproximateUsdValue?l=o.protocolFeeApproximateUsdValue:o.estimation.costsDetails&&(l=o.estimation.costsDetails.reduce(function(e,t){var r,n=null==(r=t.payload)?void 0:r.feeApproximateUsdValue;return e+(n?parseFloat(n):0)},0)),h=b.calculateEffectiveRate(s,u,c.source.decimals,c.destination.decimals),n.push({source:c.source,destination:c.destination,amountIn:s,amountOut:u,effectiveRate:h,totalFeesUsd:l,quotedAt:new Date().toISOString()}),d.logger.debug("Rate calculated",{route:"".concat(c.source.symbol,"->").concat(c.destination.symbol),notional:e,effectiveRate:h,totalFeesUsd:l}),[3,6];case 5:return f=m.sent(),d.logger.error("Failed to get rate for route",{route:"".concat(c.source.symbol,"->").concat(c.destination.symbol),notional:e,error:Q(f,Error)?f.message:"Unknown error"}),n.push(d.createFallbackRate(c,e)),[3,6];case 6:return[2]}})},p=t[Symbol.iterator](),g.label=4;case 4:if(l=(y=p.next()).done)return[3,7];return d=this,[5,X(m())];case 5:g.sent(),g.label=6;case 6:return l=!0,[3,4];case 7:return[3,10];case 8:return v=g.sent(),h=!0,f=v,[3,10];case 9:try{l||null==p.return||p.return()}finally{if(h)throw f}return[7];case 10:return a=!0,[3,2];case 11:return[3,14];case 12:return v=g.sent(),o=!0,i=v,[3,14];case 13:try{a||null==s.return||s.return()}finally{if(o)throw i}return[7];case 14:return this.logger.info("Rates fetched",{rateCount:n.length}),[2,n]}})}).call(this)}},{key:"createFallbackRate",value:function(e,t){try{var r=new p.A(t),n=new p.A("0.003"),a=r.times(new p.A(1).minus(n)),o=b.calculateEffectiveRate(t,a.toFixed(0,p.A.ROUND_DOWN),e.source.decimals,e.destination.decimals),i=b.normalizeAmount(t,e.source.decimals).toNumber();return{source:e.source,destination:e.destination,amountIn:t,amountOut:a.toFixed(0,p.A.ROUND_DOWN),effectiveRate:o,totalFeesUsd:.003*i,quotedAt:new Date().toISOString()}}catch(r){return{source:e.source,destination:e.destination,amountIn:t,amountOut:t,effectiveRate:1,totalFeesUsd:0,quotedAt:new Date().toISOString()}}}},{key:"getLiquidityDepth",value:function(e){return _(function(){var t,r,n,a,o,i,s,u,c,l,h,f,d,m,p,y,v,g,w,S,A,k;return Z(this,function(C){switch(C.label){case 0:if(!(null==e?void 0:e.length))throw Error("Routes are required for liquidity depth calculation");t=[],r=!0,n=!1,a=void 0,C.label=1;case 1:C.trys.push([1,18,19,20]),o=e[Symbol.iterator](),C.label=2;case 2:if(r=(i=o.next()).done)return[3,17];if(!(null==(s=i.value)?void 0:s.source)||!(null==s?void 0:s.destination))return console.warn("[deBridge] Invalid route structure for liquidity probing, skipping"),[3,16];C.label=3;case 3:return C.trys.push([3,15,,16]),u=b.denormalizeAmount("100",s.source.decimals),[4,this.getQuoteRate(s,u)];case 4:c=C.sent(),l=[b.denormalizeAmount("10000",s.source.decimals),b.denormalizeAmount("50000",s.source.decimals),b.denormalizeAmount("100000",s.source.decimals),b.denormalizeAmount("500000",s.source.decimals)],h=u,f=u,d=!0,m=!1,p=void 0,C.label=5;case 5:C.trys.push([5,12,13,14]),y=l[Symbol.iterator](),C.label=6;case 6:if(d=(v=y.next()).done)return[3,11];g=v.value,C.label=7;case 7:return C.trys.push([7,9,,10]),[4,this.getQuoteRate(s,g)];case 8:return w=C.sent(),(S=b.calculateSlippageBps(c,w))<=50&&(h=g),S<=100&&(f=g),[3,10];case 9:return C.sent(),[3,11];case 10:return d=!0,[3,6];case 11:return[3,14];case 12:return A=C.sent(),m=!0,p=A,[3,14];case 13:try{d||null==y.return||y.return()}finally{if(m)throw p}return[7];case 14:return t.push({route:s,thresholds:[{maxAmountIn:h,slippageBps:50},{maxAmountIn:f,slippageBps:100}],measuredAt:new Date().toISOString()}),[3,16];case 15:return console.error("[deBridge] Failed to get liquidity for route:",{error:Q(k=C.sent(),Error)?k.message:"Unknown error"}),t.push({route:s,thresholds:[{maxAmountIn:b.denormalizeAmount("50000",s.source.decimals),slippageBps:50},{maxAmountIn:b.denormalizeAmount("100000",s.source.decimals),slippageBps:100}],measuredAt:new Date().toISOString()}),[3,16];case 16:return r=!0,[3,2];case 17:return[3,20];case 18:return A=C.sent(),n=!0,a=A,[3,20];case 19:try{r||null==o.return||o.return()}finally{if(n)throw a}return[7];case 20:return[2,t]}})}).call(this)}},{key:"getQuoteRate",value:function(e,t){return _(function(){var r,n;return Z(this,function(a){switch(a.label){case 0:return(r=new URL("".concat(this.dlnApiBase,"/dln/order/create-tx"))).searchParams.set("srcChainId",e.source.chainId),r.searchParams.set("srcChainTokenIn",e.source.assetId),r.searchParams.set("srcChainTokenInAmount",t),r.searchParams.set("dstChainId",e.destination.chainId),r.searchParams.set("dstChainTokenOut",e.destination.assetId),r.searchParams.set("dstChainTokenOutAmount","auto"),r.searchParams.set("prependOperatingExpenses","true"),[4,O.fetchWithRetry(r.toString(),{headers:this.apiKey?{Authorization:"Bearer ".concat(this.apiKey)}:{}},1,500)];case 1:return n=a.sent(),[2,b.calculateEffectiveRate(n.estimation.srcChainTokenIn.amount,n.estimation.dstChainTokenOut.amount,e.source.decimals,e.destination.decimals)]}})}).call(this)}},{key:"getListedAssets",value:function(){return _(function(){var e,t,r,n,a,o,i,s,u,c,l,h,f,d,m,p,y,b,v,g;return Z(this,function(w){switch(w.label){case 0:if(e=this,t="listed-assets",r=this.assetsCache.get(t))return this.logger.debug("Assets cache hit"),[2,r];this.logger.info("Fetching listed assets"),w.label=1;case 1:return w.trys.push([1,3,,4]),n="".concat(this.dlnApiBase,"/supported-chains-info"),[4,this.dlnCircuit.execute(function(){return e.deduplicator.deduplicate(t,function(){return O.fetchWithRetry(n,{headers:e.apiKey?{Authorization:"Bearer ".concat(e.apiKey)}:{}})})})];case 2:if(!(null==(a=w.sent())?void 0:a.chains)||!Array.isArray(a.chains))throw Error("Invalid tokens response structure");o=[],i=!0,s=!1,u=void 0;try{for(c=a.chains[Symbol.iterator]();!(i=(l=c.next()).done);i=!0)if(h=l.value,Array.isArray(h.tokens)){f=!0,d=!1,m=void 0;try{for(p=h.tokens[Symbol.iterator]();!(f=(y=p.next()).done);f=!0){if(!(null==(b=y.value)?void 0:b.address)||!(null==b?void 0:b.symbol)||"number"!=typeof b.decimals){this.logger.warn("Invalid token structure, skipping",{token:b});continue}o.push({chainId:String(b.chainId),assetId:b.address,symbol:b.symbol,decimals:b.decimals})}}catch(e){d=!0,m=e}finally{try{f||null==p.return||p.return()}finally{if(d)throw m}}}}catch(e){s=!0,u=e}finally{try{i||null==c.return||c.return()}finally{if(s)throw u}}return v={assets:o.length>0?o:this.getFallbackAssets(),measuredAt:new Date().toISOString()},this.assetsCache.set(t,v),this.logger.info("Listed assets fetched",{assetCount:v.assets.length}),[2,v];case 3:return g=w.sent(),this.logger.error("Failed to fetch tokens, using fallback",{error:Q(g,Error)?g.message:String(g)}),[2,{assets:this.getFallbackAssets(),measuredAt:new Date().toISOString()}];case 4:return[2]}})}).call(this)}},{key:"getFallbackAssets",value:function(){return[{chainId:"1",assetId:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",symbol:"USDC",decimals:6},{chainId:"1",assetId:"0xdAC17F958D2ee523a2206206994597C13D831ec7",symbol:"USDT",decimals:6},{chainId:"1",assetId:"0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599",symbol:"WBTC",decimals:8},{chainId:"137",assetId:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174",symbol:"USDC",decimals:6},{chainId:"137",assetId:"0xc2132D05D31c914a87C6611C10748AEb04B58e8F",symbol:"USDT",decimals:6},{chainId:"42161",assetId:"0xFF970A61A04b1cA14834A43f5dE4533eBDDB5CC8",symbol:"USDC",decimals:6},{chainId:"10",assetId:"0x7F5c764cBc14f9669B88837ca1490cCa17c31607",symbol:"USDC",decimals:6},{chainId:"43114",assetId:"0xB97EF9Ef8734C71904D8002F8b6Bc66Dd9c48a6E",symbol:"USDC",decimals:6},{chainId:"56",assetId:"0x8AC76a51cc950d9822D68b83fE1Ad97B32Cd580d",symbol:"USDC",decimals:18}]}},{key:"ping",value:function(){var e=this;return a.Effect.tryPromise({try:function(){return _(function(){return Z(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,O.fetchWithRetry("".concat(this.dlnApiBase,"/supported-chains-info"),{headers:this.apiKey?{Authorization:"Bearer ".concat(this.apiKey)}:{}},1,500)];case 1:return e.sent(),[3,3];case 2:return console.warn("[deBridge] Health check warning:",e.sent()),[3,3];case 3:return[2,{status:"ok",timestamp:new Date().toISOString()}]}})}).call(e)},catch:function(e){return Error("Health check failed: ".concat(Q(e,Error)?e.message:String(e)))}})}}],function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,e),t}();function ee(e,t,r,n,a,o,i){try{var s=e[o](i),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(n,a)}function et(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function i(e){ee(o,n,a,i,s,"next",e)}function s(e){ee(o,n,a,i,s,"throw",e)}i(void 0)})}}function er(e,t){var r,n,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){var c=[s,u];if(r)throw TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(o=0)),o;)try{if(r=1,n&&(a=2&c[0]?n.return:c[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,c[1])).done)return a;switch(n=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,n=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===c[0]||2===c[0])){o=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){o.label=c[1];break}if(6===c[0]&&o.label<a[1]){o.label=a[1],a=c;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(c);break}a[2]&&o.ops.pop(),o.trys.pop();continue}c=t.call(e,o)}catch(e){c=[6,e],n=0}finally{r=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}let en=(0,n.createPlugin)({id:"@near-intents/debridge-data-provider",variables:o.z.object({baseUrl:o.z.string().url().default("https://dln.debridge.finance/v1.0"),timeout:o.z.number().min(1e3).max(6e4).default(3e4),rateLimitConcurrency:o.z.number().int().min(1).default(5),rateLimitMinTimeMs:o.z.number().int().min(0).default(200)}),secrets:o.z.object({apiKey:o.z.string().optional()}).optional(),contract:m,initialize:function(e){return a.Effect.gen(function(){var t,r;return er(this,function(n){switch(n.label){case 0:return O.configure({maxConcurrent:e.variables.rateLimitConcurrency,minTime:e.variables.rateLimitMinTimeMs}),[5,function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}((r=new Y(e.variables.baseUrl,null==(t=e.secrets)?void 0:t.apiKey,e.variables.timeout)).ping())];case 1:return n.sent(),[2,{service:r}]}})})},shutdown:function(){return a.Effect.void},createRouter:function(e,t){var r=e.service;return{getSnapshot:t.getSnapshot.handler(function(e){var t=e.input;return et(function(){return er(this,function(e){switch(e.label){case 0:return[4,a.Effect.runPromise(r.getSnapshot(t))];case 1:return[2,e.sent()]}})})()}),ping:t.ping.handler(function(){return et(function(){return er(this,function(e){switch(e.label){case 0:return[4,a.Effect.runPromise(r.ping())];case 1:return[2,e.sent()]}})})()})}}})}};
//# sourceMappingURL=900.js.map