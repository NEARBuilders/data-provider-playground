{"version":3,"file":"src_index_ts.js","sources":["webpack://data-provider_template/./src/contract.ts","webpack://data-provider_template/./src/index.ts","webpack://data-provider_template/./src/service.ts","webpack://data-provider_template/../../packages/shared-contract/dist/index.mjs"],"sourcesContent":["export { contract } from '@data-provider/shared-contract';\nexport type {\n  Asset,\n  Rate,\n  LiquidityDepthPoint,\n  LiquidityDepth,\n  VolumeWindow,\n  ListedAssets,\n  ProviderSnapshot,\n} from '@data-provider/shared-contract';\n","import { createPlugin } from \"every-plugin\";\nimport { Effect } from \"every-plugin/effect\";\nimport { z } from \"every-plugin/zod\";\n\nimport { contract } from \"./contract\";\nimport { DataProviderService } from \"./service\";\n\n/**\n * Data Provider Plugin Template - Template for building single-provider bridge data adapters.\n *\n * This template demonstrates how to implement the data provider contract for one provider.\n * Choose ONE provider (LayerZero, Wormhole, CCTP, Across, deBridge, Axelar, Li.Fi) and\n * replace the mock implementation with actual API calls.\n * \n */\nexport default createPlugin({\n  variables: z.object({\n    baseUrl: z.string().url().default(\"https://api.example.com\"),\n    timeout: z.number().min(1000).max(60000).default(10000),\n  }),\n\n  secrets: z.object({\n    apiKey: z.string().min(1, \"API key is required\"),\n  }),\n\n  contract,\n\n  initialize: (config) =>\n    Effect.gen(function* () {\n      // Create service instance with config\n      const service = new DataProviderService(\n        config.variables.baseUrl,\n        config.secrets.apiKey,\n        config.variables.timeout\n      );\n\n      // Test the connection during initialization\n      yield* service.ping();\n\n      return { service };\n    }),\n\n  shutdown: () => Effect.void,\n\n  createRouter: (context, builder) => {\n    const { service } = context;\n\n    return {\n      getSnapshot: builder.getSnapshot.handler(async ({ input }) => {\n        const snapshot = await Effect.runPromise(\n          service.getSnapshot(input)\n        );\n        return snapshot;\n      }),\n\n      ping: builder.ping.handler(async () => {\n        return await Effect.runPromise(service.ping());\n      }),\n    };\n  }\n});\n","import type {\n  AssetType,\n  LiquidityDepthType,\n  ListedAssetsType,\n  RateType,\n  TimeWindow,\n  VolumeWindowType\n} from \"@data-provider/shared-contract\";\nimport { Effect } from \"every-plugin/effect\";\n\n/**\n * Data Provider Service - Collects cross-chain bridge metrics from a single provider.\n *\n * Replace empty implementations with actual provider API calls\n * (LayerZero, Wormhole, CCTP, Across, deBridge, Axelar, Li.Fi, etc.)\n */\nexport class DataProviderService {\n  constructor(\n    private readonly baseUrl: string,\n    private readonly apiKey: string,\n    private readonly timeout: number\n  ) { }\n\n  /**\n   * Get complete snapshot of provider data for given routes and notionals.\n   */\n  getSnapshot(params: {\n    routes?: Array<{ source: AssetType; destination: AssetType }>;\n    notionals?: string[];\n    includeWindows?: TimeWindow[];\n  }) {\n    return Effect.tryPromise({\n      try: async () => {\n        const hasRoutes = params.routes && params.routes.length > 0;\n        const hasNotionals = params.notionals && params.notionals.length > 0;\n\n        const [volumes, listedAssets] = await Promise.all([\n          this.getVolumes(params.includeWindows || [\"24h\"]),\n          this.getListedAssets()\n        ]);\n\n        const rates = hasRoutes && hasNotionals\n          ? await this.getRates(params.routes!, params.notionals!)\n          : [];\n\n        const liquidity = hasRoutes\n          ? await this.getLiquidityDepth(params.routes!)\n          : [];\n\n        return {\n          volumes,\n          listedAssets,\n          ...(rates.length > 0 && { rates }),\n          ...(liquidity.length > 0 && { liquidity }),\n        };\n      },\n      catch: (error: unknown) =>\n        new Error(`Failed to fetch snapshot: ${error instanceof Error ? error.message : String(error)}`)\n    });\n  }\n\n  /**\n   * Fetch volume metrics for specified time windows.\n   * TODO: Implement provider's volume API endpoint\n   */\n  private async getVolumes(windows: TimeWindow[]): Promise<VolumeWindowType[]> {\n    return [];\n  }\n\n  /**\n   * Fetch rate quotes for route/notional combinations.\n   * TODO: Implement provider's quote API endpoint\n   */\n  private async getRates(routes: Array<{ source: AssetType; destination: AssetType }>, notionals: string[]): Promise<RateType[]> {\n    return [];\n  }\n\n  /**\n   * Fetch liquidity depth at 50bps and 100bps thresholds.\n   * TODO: Implement provider's liquidity API or simulate with quotes\n   */\n  private async getLiquidityDepth(routes: Array<{ source: AssetType; destination: AssetType }>): Promise<LiquidityDepthType[]> {\n    return [];\n  }\n\n  /**\n   * Fetch list of assets supported by the provider.\n   * TODO: Implement provider's assets API endpoint\n   */\n  private async getListedAssets(): Promise<ListedAssetsType> {\n    return {\n      assets: [],\n      measuredAt: new Date().toISOString(),\n    };\n  }\n\n  ping() {\n    return Effect.tryPromise({\n      try: async () => {\n        return {\n          status: \"ok\" as const,\n          timestamp: new Date().toISOString(),\n        };\n      },\n      catch: (error: unknown) => new Error(`Health check failed: ${error instanceof Error ? error.message : String(error)}`)\n    });\n  }\n}\n","import { CommonPluginErrors } from \"every-plugin\";\nimport { oc } from \"every-plugin/orpc\";\nimport { z } from \"every-plugin/zod\";\n\n//#region contract.ts\nconst Asset = z.object({\n\tchainId: z.string(),\n\tassetId: z.string(),\n\tsymbol: z.string(),\n\tdecimals: z.number().int().min(0)\n});\nconst Rate = z.object({\n\tsource: Asset,\n\tdestination: Asset,\n\tamountIn: z.string(),\n\tamountOut: z.string(),\n\teffectiveRate: z.number().describe(\"amountOut/amountIn normalized for decimals\"),\n\ttotalFeesUsd: z.number().nullable(),\n\tquotedAt: z.iso.datetime()\n});\nconst LiquidityDepthPoint = z.object({\n\tmaxAmountIn: z.string(),\n\tslippageBps: z.number()\n});\nconst LiquidityDepth = z.object({\n\troute: z.object({\n\t\tsource: Asset,\n\t\tdestination: Asset\n\t}),\n\tthresholds: z.array(LiquidityDepthPoint),\n\tmeasuredAt: z.iso.datetime()\n});\nconst VolumeWindow = z.object({\n\twindow: z.enum([\n\t\t\"24h\",\n\t\t\"7d\",\n\t\t\"30d\"\n\t]),\n\tvolumeUsd: z.number(),\n\tmeasuredAt: z.iso.datetime()\n});\nconst ListedAssets = z.object({\n\tassets: z.array(Asset),\n\tmeasuredAt: z.iso.datetime()\n});\nconst ProviderSnapshot = z.object({\n\tvolumes: z.array(VolumeWindow),\n\tlistedAssets: ListedAssets,\n\trates: z.array(Rate).optional(),\n\tliquidity: z.array(LiquidityDepth).optional()\n});\nconst contract = oc.router({\n\tgetSnapshot: oc.route({\n\t\tmethod: \"POST\",\n\t\tpath: \"/snapshot\"\n\t}).input(z.object({\n\t\troutes: z.array(z.object({\n\t\t\tsource: Asset,\n\t\t\tdestination: Asset\n\t\t})).optional(),\n\t\tnotionals: z.array(z.string()).optional(),\n\t\tincludeWindows: z.array(z.enum([\n\t\t\t\"24h\",\n\t\t\t\"7d\",\n\t\t\t\"30d\"\n\t\t])).default([\"24h\"]).optional()\n\t})).output(ProviderSnapshot).errors(CommonPluginErrors),\n\tping: oc.route({\n\t\tmethod: \"GET\",\n\t\tpath: \"/ping\"\n\t}).output(z.object({\n\t\tstatus: z.literal(\"ok\"),\n\t\ttimestamp: z.string().datetime()\n\t})).errors(CommonPluginErrors)\n});\n\n//#endregion\nexport { contract };\n//# sourceMappingURL=index.mjs.map"],"names":[],"mappings":";;;;;;;;;;;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAA;AACA;AACA;AAEA;AACA;AAEA;;;;;;;AAOA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AAEA;;;;AADA;AACA;AAMA;AACA;;AAAA;;;AAAA;AAEA;;AAAA;AAAA;AAAA;;;;AACA;;AAEA;AAAA;;AAEA;AACA;AAEA;AACA;AAAA;;AACA;;;;AAAA;;AAAA;;;AAAA;AAGA;;AAAA;;;;AACA;;AAEA;;;;;AACA;;AAAA;;;AAAA;;AAAA;;;;AACA;;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpDA;AAEA;;;;;AAKA;;AACA;AAAA;;;;AAEA;AACA;AACA;;AAJA;;AAOA;;AAEA;AACA;;AAKA;AACA;;AACA;;;;AAAA;AACA;AAEA;;AAAA;AACA;AAAA;;AACA;;;;AAFA;AAAA;;AAAA;AAKA;;;;AACA;;AAAA;;;AAAA;;;;;;;;;AADA;AAIA;;;;AACA;;AAAA;;;AAAA;;;;;;;;;AADA;AAIA;;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;;;;AAEA;;AACA;AACA;;AACA;AACA;;;AAMA;AAAA;;;AADA;;;AAEA;;;;;AACA;;;;AAMA;AAAA;;;AADA;;;AAEA;;;;;AACA;;;;AAMA;AAAA;;;AADA;;;AAEA;;;;;AACA;;;;AAMA;AAAA;;;AADA;;;AAEA;;AAAA;AACA;AACA;AACA;;;AACA;;;;AAEA;AAAA;AACA;AACA;;;AACA;;AAAA;AACA;AACA;AACA;;;AACA;;AACA;AAAA;;AACA;AACA;;;AA1FA;AA2FA;;;;;;;;;;;;;;;;AC3GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA"}